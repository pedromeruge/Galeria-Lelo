@page "/AuctionDetails/{IdLeilao:int}"
@layout LoginLayout
@using System.Text.Json
@using Classes.AuctionCard
@using Classes.Bids
@using Classes.Session
@using app.Components.Pages.Menu
@rendermode InteractiveServer
@inject IWebHostEnvironment WebHostEnvironment
@inject IJSRuntime JSRuntime
@inject Microsoft.AspNetCore.Components.NavigationManager NavigationManager
@inject Blazored.LocalStorage.ILocalStorageService localStorage
@inject IUserService UserService
@inject IBidRepository BidService
@inject IAuctionRepository AuctionService
@inject IJSRuntime JSRuntime
@using Classes.Time;


@if (Leilao != null) {
	@if (Leilao.Leilao_estado == AuctionStatus.em_leilao) {
		<AuctionDetailsOnGoing Leilao = "Leilao" />
	} else {
		<AuctionDetailsFinished Leilao ="Leilao" />
	}
} else {
	<p>Leilão não encontrado</p>
}

@code {
    [Parameter]
    public int IdLeilao { get; set; }
    public AuctionCard? Leilao { get; set; } = default!;
    public decimal currentBid;
    bool mostrarMenuLicitar = false;

	protected override async Task OnAfterRenderAsync(bool firstRender) {
		if (firstRender) {
			// ver se user existe e ta valido
			User user = await localStorage.GetItemAsync<User>("User");
			if (user == null || await UserService.checkUserValid(user) == false) NavigationManager.NavigateTo("/");
			Session session = await localStorage.GetItemAsync<Session>("Session");
			if (session == null || await UserService.checkUserValidSession(user, session) == false) NavigationManager.NavigateTo("/");
		}
	}

    protected override async Task OnInitializedAsync()
    {
		Leilao = await AuctionService.Find(IdLeilao);
    }
}